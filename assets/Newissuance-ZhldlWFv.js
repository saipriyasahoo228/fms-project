import{r as l,j as e}from"./index-K7U7e95_.js";import{B as C,P as Y,I as z,v as $,j as x}from"./IconButton-DDU6yx0X.js";import{T as K,a as Q,e as Z,c as W,d as y,b as ee}from"./TableRow-B_hpd-CW.js";import{T as w,F as B}from"./TextField-YXPWbOlt.js";import{D as se,C as te,F as oe,A as ae,a as ne,b as re,c as J,I as le}from"./Imagecompression-Clw8wG7S.js";import{C as ie,G as L}from"./CircularProgress-CyhyCx0c.js";import{F as i}from"./FormControlLabel-B_AzigHb.js";import{C as c}from"./Checkbox-B4TZK4XX.js";import{B as ce}from"./Button--os4TnKT.js";const me=({whitelevel:h,onChange:_})=>{const[n,E]=l.useState([]),[j,N]=l.useState("cttc1234"),g=async t=>{try{return(await(await fetch("http://192.168.0.166:8000/employee/name/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employee_id:t,whitelevel_id:j})})).json()).employee_name||""}catch(a){return console.error("Error fetching employee name:",a),""}};l.useEffect(()=>{_(n.map(t=>({employee_id:t.employee_id,employee_name:t.employee_name,whitelevel_id:j})))},[n,_]);const O=()=>{const t=n[n.length-1];if(t&&t.employee_id.trim()===""){alert("Please Fill The selected rows below..");return}const a=[...n,{employee_id:"",whitelevel_id:j,employee_name:"",error:!1}];E(a)},D=t=>{const a=n.filter((d,b)=>b!==t);E(a)},T=async(t,a)=>{const{name:d,value:b}=a.target,u=[...n];if(u[t][d]=b.trim(),d==="employee_id"){const P=u.some((k,R)=>k.employee_id===b&&R!==t);u[t].error=P}if(E(u),d==="employee_id"&&!u[t].error&&b.trim()!==""){const P=await g(b);u[t].employee_name=P,E(u)}};return e.jsxs(C,{sx:{position:"relative"},children:[e.jsx(K,{component:Y,sx:{border:"1px solid lightgrey",borderRadius:"8px",boxShadow:"none"},children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsxs(W,{children:[e.jsx(y,{children:"Sl. No"}),e.jsx(y,{children:"Employee ID"}),e.jsx(y,{children:"Employee Name"}),e.jsx(y,{children:"Actions"})]})}),e.jsx(ee,{children:n.map((t,a)=>e.jsxs(W,{children:[e.jsx(y,{children:a+1}),e.jsx(y,{children:e.jsx(w,{variant:"outlined",size:"small",name:"employee_id",value:t.employee_id,onChange:d=>T(a,d),fullWidth:!0,error:t.error,helperText:t.error?"Duplicate employee ID":""})}),e.jsx(y,{children:e.jsx(w,{variant:"outlined",size:"small",name:"employee_name",value:t.employee_name,onChange:d=>T(a,d),fullWidth:!0,disabled:!0})}),e.jsxs(y,{children:[e.jsx(z,{onClick:()=>D(a),children:e.jsx(se,{})}),e.jsx(z,{onClick:()=>T(a),children:e.jsx(te,{})})]})]},a))})]})}),e.jsx(oe,{color:"primary","aria-label":"add",onClick:O,size:"small",sx:{position:"absolute",bottom:-18,left:"49%",transform:"translateX(-50%)",boxShadow:"none",zIndex:1},children:e.jsx(ae,{})})]})},ye=()=>{const[h,_]=l.useState({TOOLS:!1,PPE:!1,DRESS:!1}),[n,E]=l.useState([]),[j,N]=l.useState([]),[g,O]=l.useState([]),[D,T]=l.useState(""),[t,a]=l.useState(""),[d,b]=l.useState("cttc1234"),[u,P]=l.useState(""),[k,R]=l.useState([]),[r,q]=l.useState({}),[G,A]=l.useState(!1),I=s=>{const{name:f,checked:o}=s.target;_(m=>({...m,[f]:o}))},p=(s,f)=>{const{name:o,checked:m}=s.target,v=(S,F,V)=>V?[...S,{item:F}]:S.filter(X=>X.item!==F);f==="TOOLS"&&N(S=>v(S,o,m)),f==="PPE"&&E(S=>v(S,o,m)),f==="DRESS"&&O(S=>v(S,o,m))},H=s=>{R(s)},M=()=>{let s={};return D||(s.issuance_date="Issuance date is required"),t||(s.issuance_id="Reference number is required"),h.TOOLS&&j.length===0&&(s.tools="At least one tool must be selected"),h.PPE&&n.length===0&&(s.ppe="At least one PPE must be selected"),h.DRESS&&g.length===0&&(s.dress="At least one dress must be selected"),k.length===0&&(s.employees="Employee details are required"),u||(s.accident_image="Accident image is required"),q(s),Object.keys(s).length===0},U=async()=>{if(!M())return;A(!0);const s=[...j.map(o=>({item:o.item})),...n.map(o=>({item:o.item})),...g.map(o=>({item:o.item}))],f={issuance:{issuance_id:t,issuance_date:D,white_level_id:d,accident_image:u},issued_things:s,employees:k.map(({employee_id:o,employee_name:m,whitelevel_id:v})=>({employee_id:o,employee_name:m,whitelevel_id:v}))};console.log("Submitting the following data:"),console.log(JSON.stringify(f,null,2));try{const o=await fetch("http://192.168.0.166:8000/item/new/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(o.ok){const m=await o.json();console.log("Data submitted successfully:",m),alert("New Issuance Successfully submitted.")}else{const m=await o.json();console.error("Error submitting data:",m),alert(`Error submitting data: ${m.detail||"Unknown error"}`)}}catch(o){console.error("Network error:",o),alert("Network error. Please try again.")}finally{A(!1)}};return e.jsxs(C,{className:"section",sx:{display:"flex",justifyContent:"center",padding:4},children:[e.jsx($,{sx:{color:"#fff",zIndex:s=>s.zIndex.drawer+1},open:G,children:e.jsx(ie,{color:"inherit"})}),e.jsx(ne,{sx:{width:"100%",maxWidth:1500,padding:3,boxShadow:3},children:e.jsxs(re,{children:[e.jsxs(L,{container:!0,spacing:2,marginBottom:3,children:[e.jsx(L,{item:!0,xs:12,sm:6,children:e.jsx(w,{label:"Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:D,onChange:s=>T(s.target.value),error:!!r.issuance_date,helperText:r.issuance_date})}),e.jsx(L,{item:!0,xs:12,sm:6,children:e.jsx(w,{label:"Reference Number",fullWidth:!0,value:t,onChange:s=>a(s.target.value),error:!!r.issuance_id,helperText:r.issuance_id})})]}),e.jsx(J,{sx:{marginBottom:3}}),e.jsx(x,{variant:"h6",children:"Items:"}),e.jsx(i,{control:e.jsx(c,{checked:h.TOOLS,onChange:I,name:"TOOLS"}),label:"TOOLS"}),e.jsx(i,{control:e.jsx(c,{checked:h.PPE,onChange:I,name:"PPE"}),label:"PPE"}),e.jsx(i,{control:e.jsx(c,{checked:h.DRESS,onChange:I,name:"DRESS"}),label:"DRESS"}),h.TOOLS&&e.jsxs(C,{marginBottom:3,children:[e.jsxs(B,{component:"fieldset",children:[e.jsx(x,{variant:"h6",children:"TOOLS"}),e.jsx(i,{control:e.jsx(c,{checked:j.some(s=>s.item==="3"),onChange:s=>p(s,"TOOLS"),name:"3",value:"3"}),label:"Hammer"}),e.jsx(i,{control:e.jsx(c,{checked:j.some(s=>s.item==="2"),onChange:s=>p(s,"TOOLS"),name:"2",value:"2"}),label:"Plier"}),e.jsx(i,{control:e.jsx(c,{checked:j.some(s=>s.item==="1"),onChange:s=>p(s,"TOOLS"),name:"1",value:"1"}),label:"Clamp Meter"})]}),r.tools&&e.jsx(x,{color:"error",children:r.tools})]}),h.PPE&&e.jsxs(C,{marginBottom:3,children:[e.jsxs(B,{component:"fieldset",children:[e.jsx(x,{variant:"h6",children:"PPE"}),e.jsx(i,{control:e.jsx(c,{checked:n.some(s=>s.item==="4"),onChange:s=>p(s,"PPE"),name:"4",value:"4"}),label:"Helmet"}),e.jsx(i,{control:e.jsx(c,{checked:n.some(s=>s.item==="5"),onChange:s=>p(s,"PPE"),name:"5",value:"5"}),label:"Shoe"}),e.jsx(i,{control:e.jsx(c,{checked:n.some(s=>s.item==="6"),onChange:s=>p(s,"PPE"),name:"6",value:"6"}),label:"Gloves"})]}),r.ppe&&e.jsx(x,{color:"error",children:r.ppe})]}),h.DRESS&&e.jsxs(C,{marginBottom:3,children:[e.jsxs(B,{component:"fieldset",children:[e.jsx(x,{variant:"h6",children:"DRESS"}),e.jsx(i,{control:e.jsx(c,{checked:g.some(s=>s.item==="7"),onChange:s=>p(s,"DRESS"),name:"7",value:"7"}),label:"Dress"}),e.jsx(i,{control:e.jsx(c,{checked:g.some(s=>s.item==="8"),onChange:s=>p(s,"DRESS"),name:"8",value:"8"}),label:"Jacket"}),e.jsx(i,{control:e.jsx(c,{checked:g.some(s=>s.item==="9"),onChange:s=>p(s,"DRESS"),name:"9",value:"9"}),label:"Reflecting Jacket"}),e.jsx(i,{control:e.jsx(c,{checked:g.some(s=>s.item==="10"),onChange:s=>p(s,"DRESS"),name:"10",value:"10"}),label:"Raincoat"})]}),r.dress&&e.jsx(x,{color:"error",children:r.dress})]}),e.jsx(J,{sx:{marginBottom:3}}),e.jsxs(C,{marginBottom:3,children:[e.jsx(x,{variant:"h6",children:"EMPLOYEE DETAILS:"}),e.jsx(me,{onChange:H}),r.employees&&e.jsx(x,{color:"error",children:r.employees})]}),e.jsx(le,{setCompressedImageBase64:P}),r.accident_image&&e.jsx(x,{color:"error",children:r.accident_image}),e.jsx(C,{sx:{display:"flex",justifyContent:"center",marginTop:3},children:e.jsx(ce,{variant:"contained",color:"primary",onClick:U,children:"Submit"})})]})})]})};export{ye as default};
