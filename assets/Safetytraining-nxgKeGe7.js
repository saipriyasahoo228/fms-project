import{r as i,j as e}from"./index-K7U7e95_.js";import{g as te,a as se,s as ae,j as S,u as re,b as ne,_ as le,d as oe,e as ie,B as w,P as me,I as L,v as ce}from"./IconButton-DDU6yx0X.js";import{T as de,a as pe,e as he,c as M,d as u,b as ue}from"./TableRow-B_hpd-CW.js";import{T as I}from"./TextField-YXPWbOlt.js";import{D as ye,C as fe,F as xe,A as ge,a as _e,b as je,c as J,I as Te}from"./Imagecompression-Clw8wG7S.js";import{C as be}from"./Container-DU-2yFqM.js";import{G as y,C as ve}from"./CircularProgress-CyhyCx0c.js";import{R as Ce,a as N}from"./RadioGroup-DAhucdu1.js";import{F as A}from"./FormControlLabel-B_AzigHb.js";import{A as Se}from"./Alert-BDIJcloz.js";import{B as U}from"./Button--os4TnKT.js";function Ie(m){return te("MuiAlertTitle",m)}se("MuiAlertTitle",["root"]);const Re=["className"],Ee=m=>{const{classes:s}=m;return ie({root:["root"]},Ie,s)},De=ae(S,{name:"MuiAlertTitle",slot:"Root",overridesResolver:(m,s)=>s.root})(({theme:m})=>({fontWeight:m.typography.fontWeightMedium,marginTop:-2})),Ne=i.forwardRef(function(s,c){const p=re({props:s,name:"MuiAlertTitle"}),{className:j}=p,f=ne(p,Re),h=p,T=Ee(h);return e.jsx(De,le({gutterBottom:!0,component:"div",ownerState:h,ref:c,className:oe(T.root,j)},f))}),q=({onEmployeesChange:m})=>{const[s,c]=i.useState([]),[p,j]=i.useState("cttc1234"),f=async(t,r)=>{try{return(await(await fetch("http://192.168.0.166:8000/employee/name/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employee_id:t,whitelevel_id:r})})).json()).employee_name||""}catch(n){return console.error("Error fetching employee name:",n),""}};i.useEffect(()=>{m(s.map(t=>({employee:t.employee_id==="0"?"":t.employee_id,whitelevel_id:p,employee_id:t.employee_id==="0"?"":t.employee_id,employee_name:t.employee_id==="0"?t.name:t.employee_name,trainer_id:t.employee_id,trainer_name:t.employee_id==="0"?t.name:t.employee_name,trainee_id:t.employee_id==="0"?"":t.employee_id,trainee_name:t.employee_id==="0"?"":t.employee_name})))},[s,m]);const h=()=>{if(s.length===0||s[s.length-1].employee_id&&(s[s.length-1].employee_name||s[s.length-1].name))c([...s,{employee_id:"",whitelevel_id:p,employee_name:"",name:"",error:!1,manual:!1,employee_id_error:!1,employee_name_error:!1}]);else{const r=[...s];s[s.length-1].employee_id||(r[s.length-1].employee_id_error=!0),s[s.length-1].employee_name||s[s.length-1].name||(r[s.length-1].employee_name_error=!0),c(r)}},T=t=>{const r=s.filter((n,d)=>d!==t);c(r)},b=(t,r)=>{const{name:n,value:d}=r.target,o=[...s];if(o[t][n]=d,n==="employee_id")if(o[t].employee_id_error=!1,d==="0")o[t].employee_name="",o[t].manual=!0,o[t].error=!1;else{const v=o.some((E,D)=>E.employee_id===d&&D!==t);o[t].error=v,v||f(d,p).then(E=>{o[t].employee_name=E,o[t].manual=!1,c(o)})}else o[t].employee_name_error=!1,c(o)},R=async t=>{const{employee_id:r}=s[t],n=[...s];if(r==="0")n[t].manual=!0;else{if(r){const d=await f(r,p);n[t].employee_name=d}n[t].manual=!1}c(n)};return e.jsxs(w,{sx:{position:"relative"},children:[e.jsx(de,{component:me,sx:{border:"1px solid lightgrey",borderRadius:"8px",boxShadow:"none"},children:e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs(M,{children:[e.jsx(u,{children:"Sl. No"}),e.jsx(u,{children:"Employee ID"}),e.jsx(u,{children:"Employee Name"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(ue,{children:s.map((t,r)=>e.jsxs(M,{children:[e.jsx(u,{children:r+1}),e.jsx(u,{children:e.jsx(I,{variant:"outlined",size:"small",name:"employee_id",value:t.employee_id,onChange:n=>b(r,n),fullWidth:!0,error:t.error||t.employee_id_error,helperText:t.error?"Duplicate employee ID":t.employee_id_error?"Employee ID is required":""})}),e.jsx(u,{children:e.jsx(I,{variant:"outlined",size:"small",name:t.employee_id==="0"?"name":"employee_name",value:t.employee_id==="0"?t.name:t.employee_name,onChange:n=>b(r,n),fullWidth:!0,disabled:!t.manual&&t.employee_id!=="0",error:t.employee_name_error,helperText:t.employee_name_error?"Employee Name is required":""})}),e.jsxs(u,{children:[e.jsx(L,{onClick:()=>T(r),children:e.jsx(ye,{})}),e.jsx(L,{onClick:()=>R(r),children:e.jsx(fe,{})})]})]},r))})]})}),e.jsx(xe,{color:"primary","aria-label":"add",onClick:h,size:"small",sx:{position:"absolute",bottom:-18,left:"47%",transform:"translateX(-50%)",boxShadow:"none",zIndex:1},children:e.jsx(ge,{})})]})},Je=()=>{const[m,s]=i.useState("cttc1234"),[c,p]=i.useState(""),[j,f]=i.useState(""),[h,T]=i.useState("1"),[b,R]=i.useState(""),[t,r]=i.useState(!1),[n,d]=i.useState([]),[o,v]=i.useState([]),[E,D]=i.useState(""),[P,x]=i.useState(!1),[O,B]=i.useState(""),W=(l,g)=>{l==="trainers"&&d(g),l==="trainees"&&v(g)},G=l=>{p(l.target.value)},$=l=>{const g=l.target.value;T(g),r(g==="1")},H=l=>{R(l.target.value)},K=l=>{f(l.target.value)},V=()=>{s("cttc1234"),p(""),f(""),T("1"),R(""),r(!1),d([]),v([]),D(""),x(!1),B("")},X=new Date().toISOString().split("T")[0],Q=async l=>{if(l.preventDefault(),x(!0),B(""),!c||!j||!m||h==="1"&&!b){alert("Please fill in all required fields."),x(!1);return}if(n.length===0&&o.length===0){alert("Please add at least one trainer or trainee."),x(!1);return}const g=n.map(a=>a.trainer_id).filter(a=>a),Y=o.map(a=>a.trainee_id).filter(a=>a),k=[...g,...Y],F=k.filter((a,_)=>k.indexOf(a)!==_);if(F.length>0){alert(`Duplicate entries found for IDs: ${F.join(", ")}`),x(!1);return}const Z=n.some(a=>!a.trainer_id),ee=o.some(a=>!a.trainee_id);if(Z||ee){alert("Please provide employee codes for all trainers and trainees."),x(!1);return}const z={training_id:j,training_date:c,whitelevel_id:m,training_type:h,training_name:h==="1"?b:null,trainers:n.map(({trainer_id:a,whitelevel_id:_,trainer_name:C})=>({trainer_id:a,whitelevel_id:_,trainer_name:C})),trainees:o.map(({trainee_id:a,trainee_name:_,whitelevel_id:C})=>({trainee_id:a,whitelevel_id:C,trainee_name:_}))};console.log("Submitting the following data:"),console.log(JSON.stringify(z,null,2));try{const a=await fetch("http://192.168.0.166:8000/training/start/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)});if(!a.ok){const C=await a.text();throw new Error(`HTTP error! Status: ${a.status}, Message: ${C}`)}const _=await a.json();console.log("Success:",_)}catch(a){console.error("Error in handleSubmit:",a.message),B("Network error occurred while submitting the form. Please try again later.")}finally{x(!1)}};return e.jsxs(be,{maxWidth:"xl",children:[e.jsx(w,{className:"section",sx:{display:"flex",justifyContent:"center",padding:4},children:e.jsx("form",{onSubmit:Q,children:e.jsx(_e,{sx:{width:"100%",padding:3,boxShadow:3},children:e.jsx(je,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(I,{label:"Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:c,onChange:G,max:X})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(I,{label:"Reference Number",fullWidth:!0,value:j,onChange:K})}),e.jsxs(y,{item:!0,xs:12,children:[e.jsx(J,{sx:{marginBottom:3}}),e.jsx(S,{variant:"h6",sx:{marginBottom:1},children:"Training Type:"}),e.jsxs(Ce,{row:!0,value:h,onChange:$,children:[e.jsx(A,{value:"4",control:e.jsx(N,{}),label:"Tool box Training"}),e.jsx(A,{value:"3",control:e.jsx(N,{}),label:"Job & Safety"}),e.jsx(A,{value:"2",control:e.jsx(N,{}),label:"Behavioral"}),e.jsx(A,{value:"1",control:e.jsx(N,{}),label:"Others"})]}),t&&e.jsx(I,{label:"Name of Training",fullWidth:!0,value:b,onChange:H})]}),e.jsxs(y,{item:!0,xs:12,children:[e.jsx(J,{sx:{marginBottom:3}}),e.jsx(S,{variant:"h6",children:"TRAINER:"}),e.jsx(q,{onEmployeesChange:l=>W("trainers",l)})]}),e.jsxs(y,{item:!0,xs:12,children:[e.jsx(S,{variant:"h6",children:"TRAINEE:"}),e.jsx(q,{onEmployeesChange:l=>W("trainees",l)})]}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Te,{marginBottom:3,setCompressedImageBase64:D})}),e.jsxs(y,{item:!0,xs:12,children:[O&&e.jsxs(Se,{severity:"error",sx:{mb:2},action:e.jsx(U,{color:"inherit",size:"small",onClick:V,children:"OK"}),children:[e.jsx(Ne,{children:"Error"}),O]}),e.jsx(w,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(U,{type:"submit",variant:"contained",color:"primary",disabled:P,children:"Submit"})})]})]})})})})}),e.jsxs(ce,{sx:{color:"#fff",zIndex:l=>l.zIndex.drawer+1},open:P,children:[e.jsx(ve,{color:"inherit"}),e.jsx(S,{variant:"h6",sx:{ml:2},children:"Submitting, please wait..."})]})]})};export{Je as default};
